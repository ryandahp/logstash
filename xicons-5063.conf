input {
	# beats {
        #port => "5044"
     #} 
	 
	redis{
		host => "192.168.158.27"
		port => "5044"
		key => "xicons"
		data_type => "list"
	}

}
filter {
   grok {
     patterns_dir => ["/home/ketut/Downloads/logstash/logstash-7.3.1/patterns/xicons.conf"]
     match => [ "message", "%{XICONS}" ]
   }
	
   date {
        match => ["tdate" , "yyyyMMddHHmmss"]
        target => "@timestamp"
   }
   
   #if ![promo] {
	#	mutate {
	#			add_field => { "promo" => "NO PROMO CODE" }
	#	}
   #}
   
    if [transcode] =~ /^(11|41)\d\d/{
		mutate {
				add_field => { "reversal" => "true" }
		}
		mutate {
				convert   => {"reversal" => "boolean"}
		}
   } else {
		mutate {
				add_field => { "reversal" => "false" }
		}
		mutate {
				convert   => {"reversal" => "boolean"}
		}
   }
   
   #ranslate {
	#		field => "[promo]"
	#		destination => "[promo_desc]"
	#			dictionary => {
	#			  "XN" => "LINK INQUIRY"
	#			  "XO" => "LINK WITHDRAWAL"
	#			  "NH" => "LINK MERAHPUTIH G1 INQUIRY"
	#			  "OH" => "LINK MERAHPUTIH G1 WITHDRAWAL"
	#			  "NJ" => "LINK MERAHPUTIH G2 INQUIRY"
	#			  "OJ" => "LINK MERAHPUTIH G2 WITHDRAWAL"
	#			  "X0" => "BERSAMA INQUIRY"
	#			  "X1" => "BERSAMA WITHDRAWAL"
	#			  "XL" => "CIRRUS INQUIRY"
	#			  "XM" => "CIRRUS WITHDRAWAL"
	#			  "XU" => "PRIMA INQUIRY"
	#			  "XV" => "PRIMA WITHDRAWAL"
	#			  "PG" => "PRIMA APN INQUIRY"
	#			  "PH" => "PRIMA APN WITHDRAWAL"
	#			  "BA" => "BERSAMA TFR BNI AS ACQ & ISS"
	#			  "BB" => "BERSAMA TFR BNI AS ACQ & DST"
	#			  "BC" => "BERSAMA TFR BNI AS ISS"
	#			  "BD" => "BERSAMA TFR BNI AS DST"
	#			  "BE" => "BERSAMA TFR BNI AS DST & ISS"
	#			  "LA" => "LINK TFR BNI AS ACQ & ISS"
	#			  "LB" => "LINK TFR BNI AS ACQ & DST"
	#			  "LC" => "LINK TFR BNI AS ISS"
	#			  "LD" => "LINK TFR BNI AS DST"
	#			  "HA" => "LINK MERAHPUTIH TFR BNI AS ACQ & ISS"
	#			  "HB" => "LINK MERAHPUTIH TFR BNI AS ACQ & DST"
	#			  "HC" => "LINK MERAHPUTIH TFR BNI AS ISS"
	#			  "HD" => "LINK MERAHPUTIH TFR BNI AS DST"
	#			  "HT" => "LINK MERAHPUTIH TFR BNI AS DST & ISS"
	#			  "JA" => "LINK MERAHPUTIH G1 TFR BNI AS ACQ & ISS"
	#			  "JB" => "LINK MERAHPUTIH G1 TFR BNI AS ACQ & DST"
	#			  "JC" => "LINK MERAHPUTIH G1 TFR BNI AS ISS"
	#			  "JD" => "LINK MERAHPUTIH G1 TFR BNI AS DST"
	#			  "JF" => "LINK MERAHPUTIH G2 TFR BNI AS ACQ & ISS"
	#			  "JH" => "LINK MERAHPUTIH G2 TFR BNI AS ISS"
	#			  "JI" => "LINK MERAHPUTIH G2 TFR BNI AS DST"
	#			  "JL" => "LINK MERAHPUTIH G3 TFR BNI AS ACQ & DST"
	#			  "JN" => "LINK MERAHPUTIH G3 TFR BNI AS DST"
	#			  "JS" => "LINK MERAHPUTIH G4 TFR BNI AS ACQ & DST"
	#			  "JQ" => "LINK MERAHPUTIH G4 TFR BNI AS DST"
	#			  "JV" => "LINK MERAHPUTIH G5 TFR BNI AS ACQ & DST"
	#			  "JX" => "LINK MERAHPUTIH G5 TFR BNI AS DST"
	#			  "MC" => "BERSAMA MERAHPUTIH TFR BNI AS ISS TO BRI/BTN/MANDIRI"
	#			  "MD" => "BERSAMA MERAHPUTIH TFR BNI AS DST FROM BRI/BTN/MANDIRI"
	#			  "MW" => "BERSAMA MERAHPUTIH WITHDRAWAL"
	#			  "PA" => "PRIMA TFR BNI AS ACQ & ISS"
	#			  "PB" => "PRIMA TFR BNI AS ACQ & DST"
	#			  "PC" => "PRIMA TFR BNI AS ISS"
	#			  "PD" => "PRIMA TFR BNI AS DST"
	#			  "PE" => "PRIMA TFR BNI AS DST & ISS"
	#			  "BG" => "PT ISO INQUIRY"
	#			  "BH" => "PT ISO WITHDRAWAL"
	#			  "BJ" => "INSU FUND"
	#			  "BK" => "EDC INQUIRY"
	#			  "BL" => "EDC WITHDRAWAL"
	#			  "BM" => "MONEY SEND"
	#			  "VA" => "WDL ACQUIRER ONLY - BERSAMA"
	#			  "VB" => "WDL ACQUIRER ONLY - LINK"
	#			  "VC" => "WDL ACQUIRER ONLY - MASTER CARD"
	#			  "VD" => "WDL ACQUIRER ONLY - VISA"
	#			  "VE" => "WDL ACQUIRER ONLY - CREDIT CARD"
	#			  "VF" => "WDL ACQUIRER ONLY - SYARIAH CREDIT CARD"
	#			  "CW" => "CARDLESS DUMMY PARAM"
	#			  "VK" => "WDL ISS ACQ DUMMY PARAMETER"
	#			  "SX" => "TRX BANSOS SUBSIDI"
	#			  "SY" => "TRX BANSOS SUBSIDI"
	#			  "KB" => "NO DESC"
	#			  "XP" => "NO DESC"
	#			  "XK" => "NO DESC"
	#			  "IC" => "NO DESC"
	#			  "XA" => "NO DESC"
	#			  "NO PROMO CODE" => "NO DESC"
	#			  "ZA" => "NO DESC"
	#			  "HW" => "NO DESC"
	#			}
	#}
   
   mutate { 
			remove_field => ["tags", "message","path","@version", "type", "host", "tdate","agent","input","ecs","log","offset"]
			convert => {amount => integer}
   }
}

output {
   stdout { codec => rubydebug }
   elasticsearch {
       hosts => [ "192.168.99.40:9200"]
       index => "testlocal-imgzero-%{+yyyy.MM.dd}"
	   user => "ls23" 
	   password => "bniy2k"
    }
}