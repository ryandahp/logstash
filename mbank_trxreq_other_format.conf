input {
	 beats {
        port => "5064"
     } 
	 
	#redis{
	#	host => "192.168.158.27"
	#	port => "5044"
	#	key => "apache"
	#	data_type => "list"
	 #}
	 
	# syslog {
	#	port => 12345
	#	#codec => cef
	#	#syslog_field => "syslog"
	#	locale => "en"
	#	grok_pattern=>"\<%{NUMBER}\>%{NUMBER}\s%{GREEDYDATA:message}"
	#	codec => plain
	#}

}

filter{
	mutate {
			gsub => [ "message", "\n  ", "" ]
			gsub => [ "message", "  ", "" ]
			gsub => [ "message", "\"", "" ]
			gsub => [ "message", "OKContent: {", "" ]
			gsub => [ "message", "OKContent:{", "" ]
			gsub => [ "message", " \n", "" ]
			gsub => [ "message", "\n", "" ]
			gsub => [ "message", "destinationAccountNum:,", "destinationAccountNum:" ]
			gsub => [ "message", "destinationAccountNum: ,", "destinationAccountNum:" ]
			gsub => [ "message", "{ ", "{" ]
			gsub => [ "message", ", ", "," ]
			gsub => [ "message", ", destinationAccountNum:", ",destinationAccountNum:" ]

	}
	
	#grok {
    # patterns_dir => ["patterns"]
    # match => [ "message", "%{MBANK_TRX_RP}" ]
    #}
	
	#mutate {
	#	add_field => {"xdate" => "%{xdate_}%{xtime_}"}
	#	add_field => {"xdate1" => "%{xdate_}17:00:00.000"}
	#}
	
	grok {
     patterns_dir => ["patterns"]
     match => [ "message", "%{MBANK_TRX_RP_NEW}" ]
    }
	
	
	
	#date {
   #    match => ["xdate" , "dd-MM-yyyy HH:mm:ss.SSS"]
   #    target => "@timestamp"
   #}
   
   date {
        match => ["xdate" , "yyyy-MM-dd HH:mm:ss.SSS"]
        target => "@timestamp"
   }
   
  #date {
  #     match => ["xdate1" , "yyyy-MM-ddHH:mm:ss.SSS"]
	#	target => "trx_date"
	#	
  #}
   
	kv {
			source => "transactionresponse"
			target => "transactionresponse"
			field_split_pattern =>","
			value_split => ":"
	}
	
	kv {
			source => "transactionrequest"
			target => "transactionrequest"
			field_split_pattern =>","
			value_split => ":"
	}
	
	#mutate {
	#		gsub => [ "[transactionrequest][destinationAccountNum]", " ,", "" ]
	#		gsub => [ "[transactionresponse][destinationAccountNum]", " ,", "" ]
	#}
	
	mutate {
			remove_field => ["agent", "host","type","@version", "input","tdate","ecs","log","message"]
	}
	
	#mutate {
	#	split => {"[transactionrequest][destinationAccountNum]" => " "}
	#	split => {"[transactionresponse][destinationAccountNum]" => " "}
	#}
	
	#split {
	#	field => "[transactionrequest][destinationAccountNum]"
	#	target => "destinationAccountNum_rq"
	#	terminator => " "
	#}
	
	mutate {
		add_field => { "rq_destinationAccountNum" => "%{[transactionrequest][destinationAccountNum]}" }
		add_field => { "rp_destinationAccountNum" => "%{[transactionresponse][destinationAccountNum]}" }
	}
	
	#mutate {
	#	gsub => [ "rq_destinationAccountNum", "Rp", "" ]
	#	gsub => [ "rq_destinationAccountNum", "bri", "" ]
	#	gsub => [ "rq_destinationAccountNum", "Gitu, ya?", "" ]
	#	gsub => [ "rq_destinationAccountNum", "R", "" ]
	#	gsub => [ "rq_destinationAccountNum", "BRI", "" ]
	#	gsub => [ "rq_destinationAccountNum", "anSuherman", "" ]
	#	gsub => [ "rq_destinationAccountNum", "bca", "" ]
	#	gsub => [ "rq_destinationAccountNum", "ini", "" ]
	#}
	
	mutate {
		gsub => [ "rq_destinationAccountNum", "[a-zA-Z]", "" ]
		gsub => [ "rp_destinationAccountNum", "[a-zA-Z]", "" ]
	}
	
	mutate {
		split => {"rq_destinationAccountNum" => " "}
		split => {"rp_destinationAccountNum" => " "}
	}
	
	if [rq_destinationAccountNum][0] == [rp_destinationAccountNum][0] {
		mutate {
				add_field => { "diff" => "false" }
		}
		mutate {
				convert   => {"diff" => "boolean"}
		}
   } else {
		mutate {
				add_field => { "diff" => "true" }
		}
		mutate {
				convert   => {"diff" => "boolean"}
		}
	}
}
#filter {
#
#	   grok {
#		 patterns_dir => ["patterns"]
#		 match => [ "message", "%{IIS_MBANK}" ]
#	   }
#		
#	   date {
#			match => ["xdate" , "yyyy-MM-dd HH:mm:ss"]
#			target => "@timestamp"
#			timezone => "UTC"
#	   }
#	   #mutate { 
#		#remove_field => ["[agent][ephemeral_id]","[agent][id]","[agent][type]","[fields][slogname]","[fields][srvtype]","xdate", "message","xtimestamp","cs\-*"]	
#	   #}
#	
#
# }
output {
		stdout { 
				codec => rubydebug 
		}
		
		elasticsearch {
			hosts => [ "192.168.99.40:9200"]
			index => "mbanktrx-%{+YYYY.MM.dd}"
			user  => "ls23"
			password  => "bniy2k"
		}
}
